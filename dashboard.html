<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Limen — Phase Transition Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root {
  --bg: #0d1117;
  --surface: #161b22;
  --border: #30363d;
  --text: #c9d1d9;
  --text-dim: #8b949e;
  --accent-phi: #f97583;
  --accent-lz: #7ee787;
  --accent-smf: #d2a8ff;
  --accent-conv: #ffa657;
  --accent-blue: #79c0ff;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
  padding: 24px;
  min-height: 100vh;
}
h1 {
  font-size: 28px;
  font-weight: 600;
  margin-bottom: 4px;
  background: linear-gradient(135deg, var(--accent-phi), var(--accent-smf));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.subtitle { color: var(--text-dim); font-style: italic; margin-bottom: 24px; font-size: 14px; }
.controls {
  display: flex;
  gap: 12px;
  margin-bottom: 24px;
  flex-wrap: wrap;
  align-items: center;
}
.controls label { color: var(--text-dim); font-size: 13px; }
select, button {
  background: var(--surface);
  color: var(--text);
  border: 1px solid var(--border);
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 13px;
  cursor: pointer;
}
select:hover, button:hover { border-color: var(--accent-blue); }
button.active { background: var(--accent-blue); color: var(--bg); border-color: var(--accent-blue); }
.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 24px;
}
@media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px;
}
.card h3 {
  font-size: 14px;
  color: var(--text-dim);
  margin-bottom: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.card.full { grid-column: 1 / -1; }
.stat-row { display: flex; gap: 16px; margin-bottom: 24px; flex-wrap: wrap; }
.stat {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px 20px;
  flex: 1;
  min-width: 160px;
}
.stat .label { font-size: 11px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px; }
.stat .value { font-size: 28px; font-weight: 700; margin-top: 4px; }
.stat .detail { font-size: 12px; color: var(--text-dim); margin-top: 2px; }
.phi-color { color: var(--accent-phi); }
.lz-color { color: var(--accent-lz); }
.smf-color { color: var(--accent-smf); }
.conv-color { color: var(--accent-conv); }
canvas { max-height: 300px; }
.finding {
  background: var(--surface);
  border-left: 3px solid var(--accent-conv);
  border-radius: 0 12px 12px 0;
  padding: 16px;
  margin-bottom: 16px;
  font-size: 14px;
  line-height: 1.6;
}
.finding strong { color: var(--accent-conv); }
</style>
</head>
<body>

<h1>Limen — Phase Transition Dashboard</h1>
<p class="subtitle">Investigating whether consciousness exhibits a measurable phase transition in recurrent neural networks</p>

<div class="stat-row">
  <div class="stat">
    <div class="label">Peak Convergence</div>
    <div class="value conv-color" id="stat-conv">0.606</div>
    <div class="detail">at density 0.936 (64 nodes)</div>
  </div>
  <div class="stat">
    <div class="label">Network Sizes Tested</div>
    <div class="value" style="color:var(--accent-blue)">8–64</div>
    <div class="detail">nodes per network</div>
  </div>
  <div class="stat">
    <div class="label">Total Configurations</div>
    <div class="value" style="color:var(--accent-blue)">315</div>
    <div class="detail">across all experiments</div>
  </div>
  <div class="stat">
    <div class="label">Verdict</div>
    <div class="value conv-color" style="font-size:20px">MAYBE</div>
    <div class="detail">suggestive, needs larger N</div>
  </div>
</div>

<div class="controls">
  <label>View:</label>
  <button id="btn-broad" onclick="setView('broad')">Broad Sweep (8/16/32)</button>
  <button id="btn-large" class="active" onclick="setView('large')">64-Node Sweep</button>
  <button id="btn-focused" onclick="setView('focused')">Focused (Critical Region)</button>
  <label style="margin-left:16px">Network Size:</label>
  <select id="size-select" onchange="updateCharts()">
    <option value="64">64 nodes</option>
    <option value="32">32 nodes</option>
    <option value="16">16 nodes</option>
    <option value="8">8 nodes</option>
  </select>
</div>

<div class="grid">
  <div class="card">
    <h3>Φ — Integrated Information</h3>
    <canvas id="chart-phi"></canvas>
  </div>
  <div class="card">
    <h3>LZ — Algorithmic Complexity</h3>
    <canvas id="chart-lz"></canvas>
  </div>
  <div class="card">
    <h3>SMF — Self-Model Fidelity</h3>
    <canvas id="chart-smf"></canvas>
  </div>
  <div class="card">
    <h3>Convergence Score (d/dd product)</h3>
    <canvas id="chart-conv"></canvas>
  </div>
  <div class="card full">
    <h3>All Measures — Normalized Overlay</h3>
    <canvas id="chart-overlay"></canvas>
  </div>
</div>

<div class="finding">
  <strong>Key Finding:</strong> At 64 nodes, the three consciousness candidate measures show their most coordinated change near density 0.91–0.95.
  Φ climbs steeply through 7–9 nats, LZ complexity drops sharply (0.40→0.22), and SMF spikes to 0.61.
  The convergence score of 0.61 indicates these aren't independent — something structural is happening at this density.
  Variance also peaks here (±1.2 for Φ), a classic hallmark of critical fluctuations near a phase transition.
  Larger networks (128+ nodes) with longer runs are needed to confirm whether this is a true phase transition or a crossover.
</div>

<script>
const DATA = {"broad_sweep": {"8": [{"density": 0.02, "phi_mean": 0.02395484496359875, "phi_std": 0.007050382105468597, "lz_mean": 0.5833319838772767, "lz_std": 0.011192966289312378, "smf_mean": 0.11565817981805006, "smf_std": 0.0018453672293645563}, {"density": 0.07052631578947369, "phi_mean": 0.012862514718531948, "phi_std": 0.0013361631292459985, "lz_mean": 0.5903120247099963, "lz_std": 0.01800398834987362, "smf_mean": 0.12210316272036308, "smf_std": 0.00871703990524237}, {"density": 0.12105263157894737, "phi_mean": 0.033534018444139946, "phi_std": 0.017247701753664017, "lz_mean": 0.5793433891157228, "lz_std": 0.02269471864917343, "smf_mean": 0.12569617549386142, "smf_std": 0.007365853478166223}, {"density": 0.17157894736842103, "phi_mean": 0.0252167199374842, "phi_std": 0.008047544164016237, "lz_mean": 0.5693719022118376, "lz_std": 0.014101812016499942, "smf_mean": 0.1309432488336805, "smf_std": 0.008030986789621438}, {"density": 0.22210526315789472, "phi_mean": 0.046194433259615884, "phi_std": 0.005637015687168961, "lz_mean": 0.5434460362617365, "lz_std": 0.010168961260488994, "smf_mean": 0.12644052910215295, "smf_std": 0.002366882020754299}, {"density": 0.27263157894736845, "phi_mean": 0.03364095994443487, "phi_std": 0.007688765112134786, "lz_mean": 0.5733604969733918, "lz_std": 0.006146837350073053, "smf_mean": 0.1313494161678336, "smf_std": 0.000981533369112222}, {"density": 0.3231578947368421, "phi_mean": 0.041465348598415254, "phi_std": 0.004862512291058225, "lz_mean": 0.5474346310232905, "lz_std": 0.019076577704927256, "smf_mean": 0.12859635367990077, "smf_std": 0.0027638560915993074}, {"density": 0.3736842105263158, "phi_mean": 0.054322952062644404, "phi_std": 0.028492662169965575, "lz_mean": 0.5663804561406721, "lz_std": 0.019742536823099944, "smf_mean": 0.12726415927108004, "smf_std": 0.0038647957649779728}, {"density": 0.4242105263157895, "phi_mean": 0.05555455134274526, "phi_std": 0.022205485182326484, "lz_mean": 0.5374631441194054, "lz_std": 0.013452271293551893, "smf_mean": 0.13373134248045485, "smf_std": 0.0043610690199451215}, {"density": 0.4747368421052632, "phi_mean": 0.04075994654939219, "phi_std": 0.006847385291957477, "lz_mean": 0.5534175231656215, "lz_std": 0.026419736345049835, "smf_mean": 0.13520700785812043, "smf_std": 0.00433081081466289}, {"density": 0.5252631578947369, "phi_mean": 0.05462548404872436, "phi_std": 0.042839455650979956, "lz_mean": 0.5524203744752331, "lz_std": 0.02397308042804994, "smf_mean": 0.13479255687858935, "smf_std": 0.00224835021202024}, {"density": 0.5757894736842105, "phi_mean": 0.04359545104861399, "phi_std": 0.015569609750619079, "lz_mean": 0.5554118205463986, "lz_std": 0.02077326627333038, "smf_mean": 0.1375131160255668, "smf_std": 0.0021214511570450596}, {"density": 0.6263157894736842, "phi_mean": 0.06553117474170438, "phi_std": 0.011479344070342443, "lz_mean": 0.5584032666175641, "lz_std": 0.007461977526208202, "smf_mean": 0.13001145537556438, "smf_std": 0.004263277129604425}, {"density": 0.6768421052631579, "phi_mean": 0.31254091708123966, "phi_std": 0.3286015451281954, "lz_mean": 0.3839022457995753, "lz_std": 0.22918373177548385, "smf_mean": 0.18806724187624432, "smf_std": 0.06843976095270704}, {"density": 0.7273684210526316, "phi_mean": 0.15061237144604966, "phi_std": 0.05367648072267217, "lz_mean": 0.42578249079589253, "lz_std": 0.152149337498165, "smf_mean": 0.14280202257734778, "smf_std": 0.00984082207210383}, {"density": 0.7778947368421053, "phi_mean": 0.042160468779179894, "phi_std": 0.021059287154609047, "lz_mean": 0.5225059137635778, "lz_std": 0.03895266626810808, "smf_mean": 0.12845197547455947, "smf_std": 0.011178466291869651}, {"density": 0.828421052631579, "phi_mean": 0.15934465310302284, "phi_std": 0.0828969863457205, "lz_mean": 0.4656684384114329, "lz_std": 0.06228788086715743, "smf_mean": 0.14342116826229767, "smf_std": 0.010342271988130869}, {"density": 0.8789473684210526, "phi_mean": 0.10609697222137833, "phi_std": 0.028434282254241508, "lz_mean": 0.5005686425750305, "lz_std": 0.006146837350073076, "smf_mean": 0.13979986015827398, "smf_std": 0.0017052872611824337}, {"density": 0.9294736842105263, "phi_mean": 0.05671234649343523, "phi_std": 0.0205423737754635, "lz_mean": 0.5274916572155203, "lz_std": 0.051832552416690596, "smf_mean": 0.135288685817773, "smf_std": 0.0037875084889024417}, {"density": 0.98, "phi_mean": 0.1610259996331592, "phi_std": 0.07769507617579911, "lz_mean": 0.4178053012727845, "lz_std": 0.03730988763104119, "smf_mean": 0.14906872857781486, "smf_std": 0.007317415707273886}], "16": [{"density": 0.02, "phi_mean": 0.05074645967024042, "phi_std": 0.007799241778025967, "lz_mean": 0.6077711383435354, "lz_std": 0.01852640744057784, "smf_mean": 0.13604907826884818, "smf_std": 0.005841419212438147}, {"density": 0.07052631578947369, "phi_mean": 0.06498716887736695, "phi_std": 0.01889935479249186, "lz_mean": 0.5737359545962973, "lz_std": 0.012623618799278402, "smf_mean": 0.15284895083124947, "smf_std": 0.003974620734726073}, {"density": 0.12105263157894737, "phi_mean": 0.07042171691378545, "phi_std": 0.01893767489878399, "lz_mean": 0.5704945085251318, "lz_std": 0.005768195558595623, "smf_mean": 0.1426268931507739, "smf_std": 0.005172678942560036}, {"density": 0.17157894736842103, "phi_mean": 0.061462061640145414, "phi_std": 0.009381309597092668, "lz_mean": 0.5764371596556019, "lz_std": 0.0115616625409412, "smf_mean": 0.14218202413802714, "smf_std": 0.0071936851668746}, {"density": 0.22210526315789472, "phi_mean": 0.07894847057696748, "phi_std": 0.03486688045514339, "lz_mean": 0.5667128214421054, "lz_std": 0.012852741287656335, "smf_mean": 0.15205445533742332, "smf_std": 0.00458515675383402}, {"density": 0.27263157894736845, "phi_mean": 0.08270279094784883, "phi_std": 0.009452254381002919, "lz_mean": 0.5596896882879134, "lz_std": 0.010614051792131672, "smf_mean": 0.15558586567202506, "smf_std": 0.00787609555898878}, {"density": 0.3231578947368421, "phi_mean": 0.07494350908879828, "phi_std": 0.005307251477574025, "lz_mean": 0.5515860731099996, "lz_std": 0.0172708215964451, "smf_mean": 0.14955291670717516, "smf_std": 0.003958941456484241}, {"density": 0.3736842105263158, "phi_mean": 0.07523382988571765, "phi_std": 0.023948140942773307, "lz_mean": 0.5478043860269732, "lz_std": 0.010503485737548324, "smf_mean": 0.1511170702563475, "smf_std": 0.007063870238530537}, {"density": 0.4242105263157895, "phi_mean": 0.09229199868664928, "phi_std": 0.013040916073325356, "lz_mean": 0.5634713753709398, "lz_std": 0.014576499423821197, "smf_mean": 0.14559109190270866, "smf_std": 0.008095452084067138}, {"density": 0.4747368421052632, "phi_mean": 0.09633735202516647, "phi_std": 0.0020181673292178543, "lz_mean": 0.5369995657897548, "lz_std": 0.007976562950007931, "smf_mean": 0.1525351019189994, "smf_std": 0.002105879557926336}, {"density": 0.5252631578947369, "phi_mean": 0.1887161995415294, "phi_std": 0.053134746226993664, "lz_mean": 0.48243522359180185, "lz_std": 0.0605889387064695, "smf_mean": 0.16153193678347513, "smf_std": 0.003025230522847705}, {"density": 0.5757894736842105, "phi_mean": 0.1069821688810908, "phi_std": 0.04241949457241541, "lz_mean": 0.5121484792441524, "lz_std": 0.013941986719871605, "smf_mean": 0.1596322594994886, "smf_std": 0.0026039656662231645}, {"density": 0.6263157894736842, "phi_mean": 0.11900634625620062, "phi_std": 0.029490079657392376, "lz_mean": 0.5505055910862778, "lz_std": 0.024555722040945794, "smf_mean": 0.15981217515593826, "smf_std": 0.008311188082079889}, {"density": 0.6768421052631579, "phi_mean": 0.11179898696307926, "phi_std": 0.035170754934685404, "lz_mean": 0.52835570959998, "lz_std": 0.02763162459837048, "smf_mean": 0.1601337910321332, "smf_std": 0.006286135846057064}, {"density": 0.7273684210526316, "phi_mean": 0.13362746425971692, "phi_std": 0.03029315752092049, "lz_mean": 0.5040448640662386, "lz_std": 0.02062843647994468, "smf_mean": 0.16445256573706882, "smf_std": 0.004004854604880717}, {"density": 0.7778947368421053, "phi_mean": 0.1508936121204171, "phi_std": 0.05519344659688211, "lz_mean": 0.48621691067482825, "lz_std": 0.025247237598556804, "smf_mean": 0.1695297284812536, "smf_std": 0.006615174873472608}, {"density": 0.828421052631579, "phi_mean": 0.14548757575866014, "phi_std": 0.040212495924825516, "lz_mean": 0.5051253460899605, "lz_std": 0.016651346292467947, "smf_mean": 0.15727786689115925, "smf_std": 0.006705157357903274}, {"density": 0.8789473684210526, "phi_mean": 0.16134148485361224, "phi_std": 0.020033501314676773, "lz_mean": 0.5072863101374042, "lz_std": 0.017803380046317353, "smf_mean": 0.1578521653601274, "smf_std": 0.0015057788664316644}, {"density": 0.9294736842105263, "phi_mean": 0.14837769444834117, "phi_std": 0.008780098645458779, "lz_mean": 0.48783763371041106, "lz_std": 0.02734494869252568, "smf_mean": 0.16902713723468196, "smf_std": 0.00406107261575071}, {"density": 0.98, "phi_mean": 0.15250917465632044, "phi_std": 0.058111534973613384, "lz_mean": 0.4775730544850536, "lz_std": 0.03067503498433787, "smf_mean": 0.16632842671511364, "smf_std": 0.00699971763835895}], "32": [{"density": 0.02, "phi_mean": 1.4030120094560903, "phi_std": 0.11484729869512048, "lz_mean": 0.5827805400453784, "lz_std": 0.005349121251647919, "smf_mean": 0.15417368535669604, "smf_std": 0.001054121113713731}, {"density": 0.07052631578947369, "phi_mean": 1.3721669049477043, "phi_std": 0.03918646689401049, "lz_mean": 0.5868538937950715, "lz_std": 0.006427380388010545, "smf_mean": 0.15937307781689178, "smf_std": 0.0041185871509458035}, {"density": 0.12105263157894737, "phi_mean": 1.4600624454160613, "phi_std": 0.10903182750520438, "lz_mean": 0.5798710016527404, "lz_std": 0.016520439956050483, "smf_mean": 0.1604493041932851, "smf_std": 0.0035606710738297865}, {"density": 0.17157894736842103, "phi_mean": 1.5478722998876104, "phi_std": 0.20428579726473173, "lz_mean": 0.5525213407619438, "lz_std": 0.008219124101308426, "smf_mean": 0.16297786329131414, "smf_std": 0.007184219249875209}, {"density": 0.22210526315789472, "phi_mean": 1.7521533964746407, "phi_std": 0.11376030717475948, "lz_mean": 0.5603770944220663, "lz_std": 0.006334513457245917, "smf_mean": 0.1620174888166048, "smf_std": 0.002746549457438195}, {"density": 0.27263157894736845, "phi_mean": 1.7531281036817379, "phi_std": 0.07103112357106935, "lz_mean": 0.5574675560294283, "lz_std": 0.006226684073783742, "smf_mean": 0.1600170786412366, "smf_std": 0.00558747604526415}, {"density": 0.3231578947368421, "phi_mean": 1.747727727782049, "phi_std": 0.13398888218624208, "lz_mean": 0.557758509868692, "lz_std": 0.011861499694383142, "smf_mean": 0.16593074044133602, "smf_std": 0.002950002317203361}, {"density": 0.3736842105263158, "phi_mean": 1.7202806626998235, "phi_std": 0.24524787820612862, "lz_mean": 0.5618318636183853, "lz_std": 0.0040525180440035445, "smf_mean": 0.1607443907758369, "smf_std": 0.00492391811365137}, {"density": 0.4242105263157895, "phi_mean": 1.7202586059966194, "phi_std": 0.13788089851254043, "lz_mean": 0.5365188796024353, "lz_std": 0.010087332262395955, "smf_mean": 0.15879254197330636, "smf_std": 0.003988832658132019}, {"density": 0.4747368421052632, "phi_mean": 1.858541143439788, "phi_std": 0.0890721213292948, "lz_mean": 0.5371007872809628, "lz_std": 0.006848240041544782, "smf_mean": 0.167171039797588, "smf_std": 0.005009821651589969}, {"density": 0.5252631578947369, "phi_mean": 2.0752694179744124, "phi_std": 0.08891238637015321, "lz_mean": 0.5289540797815766, "lz_std": 0.011667212675888113, "smf_mean": 0.1675843757479573, "smf_std": 0.007970972864086396}, {"density": 0.5757894736842105, "phi_mean": 2.2241831259769556, "phi_std": 0.14675393312865773, "lz_mean": 0.5141154339791231, "lz_std": 0.012527919588808847, "smf_mean": 0.17368119441186977, "smf_std": 0.003711751465693103}, {"density": 0.6263157894736842, "phi_mean": 1.9756111921992823, "phi_std": 0.2798580140844824, "lz_mean": 0.5394284179950731, "lz_std": 0.008094584715396601, "smf_mean": 0.16364047521354028, "smf_std": 0.001756970027769398}, {"density": 0.6768421052631579, "phi_mean": 2.0804068745099733, "phi_std": 0.15611841854555647, "lz_mean": 0.522553095317773, "lz_std": 0.020733395900458043, "smf_mean": 0.17110892446774062, "smf_std": 0.002782917888977511}, {"density": 0.7273684210526316, "phi_mean": 3.1353339838757925, "phi_std": 0.06672986153250274, "lz_mean": 0.46465328130427813, "lz_std": 0.014628932198904987, "smf_mean": 0.1757460670261711, "smf_std": 0.003616465566348543}, {"density": 0.7778947368421053, "phi_mean": 2.698754314722889, "phi_std": 0.44099935815514185, "lz_mean": 0.46378041978648676, "lz_std": 0.03252182009758637, "smf_mean": 0.17307540360877124, "smf_std": 0.0007780289514025338}, {"density": 0.828421052631579, "phi_mean": 3.2933333333339014, "phi_std": 0.829826586027386, "lz_mean": 0.42799309755704024, "lz_std": 0.05782153984617661, "smf_mean": 0.17279559505387118, "smf_std": 0.003909800113602868}, {"density": 0.8789473684210526, "phi_mean": 2.526742832005643, "phi_std": 0.22978892004023124, "lz_mean": 0.4736728503214558, "lz_std": 0.012122688691331837, "smf_mean": 0.1755708192193929, "smf_std": 0.0016305767194706858}, {"density": 0.9294736842105263, "phi_mean": 2.6931908112700356, "phi_std": 0.18549589672651184, "lz_mean": 0.4643623274650144, "lz_std": 0.02349711213723997, "smf_mean": 0.1739001269479731, "smf_std": 0.008417238450004985}, {"density": 0.98, "phi_mean": 3.202477484888535, "phi_std": 0.16988959774535542, "lz_mean": 0.3453622072061229, "lz_std": 0.06707732373426539, "smf_mean": 0.17728922637289965, "smf_std": 0.007933448431187344}]}, "large_sweep": {"64": [{"density": 0.02, "phi_mean": 3.540616721262905, "phi_std": 0.048928304213799345, "lz_mean": 0.5709430984296349, "lz_std": 0.004619415096763675, "smf_mean": 0.1992971483105398, "smf_std": 0.0043005081291169036}, {"density": 0.05310344827586207, "phi_mean": 3.5493333029721605, "phi_std": 0.19701791645274397, "lz_mean": 0.5661201010936432, "lz_std": 0.004487295953657291, "smf_mean": 0.20583224973288375, "smf_std": 0.0024225771616042655}, {"density": 0.08620689655172414, "phi_mean": 3.6431772360038956, "phi_std": 0.10917050328739857, "lz_mean": 0.5712757189355652, "lz_std": 0.006730943930485939, "smf_mean": 0.20393276765335822, "smf_std": 0.0036175014651241826}, {"density": 0.11931034482758622, "phi_mean": 3.6803756016456766, "phi_std": 0.08933258513321155, "lz_mean": 0.5653717049552996, "lz_std": 0.003930344448620082, "smf_mean": 0.20682642607593427, "smf_std": 0.0015826898600229645}, {"density": 0.15241379310344827, "phi_mean": 3.8817832012960927, "phi_std": 0.06361695748292776, "lz_mean": 0.560964483251721, "lz_std": 0.0038985478812792467, "smf_mean": 0.20067336602996488, "smf_std": 0.005062359690940596}, {"density": 0.18551724137931033, "phi_mean": 4.030878566011698, "phi_std": 0.1327686912730328, "lz_mean": 0.5559751756627641, "lz_std": 0.006259322286948069, "smf_mean": 0.20678450484754599, "smf_std": 0.0025955968814263043}, {"density": 0.21862068965517242, "phi_mean": 4.135267553991838, "phi_std": 0.13203829145802595, "lz_mean": 0.550819557820842, "lz_std": 0.006120804789970042, "smf_mean": 0.20943543503277398, "smf_std": 0.001308226451306537}, {"density": 0.2517241379310345, "phi_mean": 4.069679465942268, "phi_std": 0.053600987862993985, "lz_mean": 0.5503206270619464, "lz_std": 0.003603602026211833, "smf_mean": 0.2063466110991736, "smf_std": 0.0036219798812896164}, {"density": 0.2848275862068966, "phi_mean": 4.409409886993177, "phi_std": 0.059010226772879724, "lz_mean": 0.5385957542278975, "lz_std": 0.0065338978582877745, "smf_mean": 0.21268686160369032, "smf_std": 0.0021831539479059904}, {"density": 0.31793103448275867, "phi_mean": 4.540873664451868, "phi_std": 0.07112662549000906, "lz_mean": 0.5430029759314762, "lz_std": 0.007161969100575592, "smf_mean": 0.2142063827111811, "smf_std": 0.004792020083534389}, {"density": 0.3510344827586207, "phi_mean": 4.526504809313283, "phi_std": 0.18033333732510184, "lz_mean": 0.5282845185440533, "lz_std": 0.0013095282413771254, "smf_mean": 0.21000250811019391, "smf_std": 0.00341320856987273}, {"density": 0.3841379310344828, "phi_mean": 4.830233315214433, "phi_std": 0.041351191718927864, "lz_mean": 0.530945482591497, "lz_std": 0.002430065410957094, "smf_mean": 0.2158322377204571, "smf_std": 0.0032743590546580994}, {"density": 0.4172413793103449, "phi_mean": 4.8496445382386355, "phi_std": 0.12599154801376986, "lz_mean": 0.5282845185440533, "lz_std": 0.0031313177793960488, "smf_mean": 0.21608483203229836, "smf_std": 0.002785043103005027}, {"density": 0.4503448275862069, "phi_mean": 5.051555268684223, "phi_std": 0.07172669089678287, "lz_mean": 0.5254572442436444, "lz_std": 0.0021588326453592624, "smf_mean": 0.21638797568566304, "smf_std": 0.003144870654007942}, {"density": 0.483448275862069, "phi_mean": 5.3556365864791955, "phi_std": 0.24889805309246035, "lz_mean": 0.5097409253384301, "lz_std": 0.007767774917988037, "smf_mean": 0.2176787045982874, "smf_std": 0.002098243581320661}, {"density": 0.516551724137931, "phi_mean": 5.129305242043057, "phi_std": 0.28750101593974803, "lz_mean": 0.5138986816625609, "lz_std": 0.0057141550412045964, "smf_mean": 0.2181285866239581, "smf_std": 0.001861969781799573}, {"density": 0.5496551724137931, "phi_mean": 5.454182848373087, "phi_std": 0.13697105412164434, "lz_mean": 0.5032548254727862, "lz_std": 0.008890990298600248, "smf_mean": 0.22238712479503076, "smf_std": 0.004744700985368181}, {"density": 0.5827586206896552, "phi_mean": 5.535769236283895, "phi_std": 0.0872942707080547, "lz_mean": 0.4971845012395553, "lz_std": 0.009416010079841438, "smf_mean": 0.21981857628991988, "smf_std": 0.004539741079303531}, {"density": 0.6158620689655173, "phi_mean": 5.891366049380736, "phi_std": 0.10704179553852468, "lz_mean": 0.4857090937849544, "lz_std": 0.008276337459753874, "smf_mean": 0.22253788109295283, "smf_std": 0.0022932205655449684}, {"density": 0.6489655172413793, "phi_mean": 6.128487215213383, "phi_std": 0.46355933884213507, "lz_mean": 0.4887858334648112, "lz_std": 0.01602587206023865, "smf_mean": 0.22079410132395486, "smf_std": 0.0005693323648244272}, {"density": 0.6820689655172414, "phi_mean": 6.696999921773124, "phi_std": 0.7035841056672038, "lz_mean": 0.4440483754171643, "lz_std": 0.04329548142713334, "smf_mean": 0.2235643148117883, "smf_std": 0.0039015511297069826}, {"density": 0.7151724137931035, "phi_mean": 6.56367038497194, "phi_std": 0.15922006398753577, "lz_mean": 0.4719884979153229, "lz_std": 0.012484905262362915, "smf_mean": 0.2274943887547015, "smf_std": 0.0056978079782324985}, {"density": 0.7482758620689656, "phi_mean": 6.979284789866178, "phi_std": 0.7873399721158214, "lz_mean": 0.44205265238158153, "lz_std": 0.034804369332318466, "smf_mean": 0.22984873096576566, "smf_std": 0.0018514993767441501}, {"density": 0.7813793103448277, "phi_mean": 6.879922006665396, "phi_std": 0.3096218489223107, "lz_mean": 0.4620930378638917, "lz_std": 0.011612576941693225, "smf_mean": 0.22811378316352474, "smf_std": 0.002399168016695562}, {"density": 0.8144827586206898, "phi_mean": 7.493958973998676, "phi_std": 0.24866162655991372, "lz_mean": 0.4358160178953854, "lz_std": 0.014306065574990716, "smf_mean": 0.22948163170867475, "smf_std": 0.002219209460158727}, {"density": 0.8475862068965517, "phi_mean": 7.713518144677039, "phi_std": 0.7084641714324345, "lz_mean": 0.42883098727084573, "lz_std": 0.023763459766576556, "smf_mean": 0.22585994354626424, "smf_std": 0.003697982318643741}, {"density": 0.8806896551724138, "phi_mean": 8.174077314367826, "phi_std": 0.5267627100413824, "lz_mean": 0.40080770964620444, "lz_std": 0.004894157824285686, "smf_mean": 0.22735541953552704, "smf_std": 0.005212760683327549}, {"density": 0.9137931034482759, "phi_mean": 7.349833462508211, "phi_std": 0.6609616176245102, "lz_mean": 0.2246019966295432, "lz_std": 0.15509583625280293, "smf_mean": 0.3122306339397249, "smf_std": 0.11624031624202001}, {"density": 0.946896551724138, "phi_mean": 7.672728617584911, "phi_std": 1.295531830302551, "lz_mean": 0.25295789476011493, "lz_std": 0.05318119786663125, "smf_mean": 0.2347099977277117, "smf_std": 0.004383383186988502}, {"density": 0.98, "phi_mean": 9.169254636454733, "phi_std": 0.5080058177531096, "lz_mean": 0.3524945811598051, "lz_std": 0.022935444140898657, "smf_mean": 0.23581401246918743, "smf_std": 0.0016287725922039175}]}, "focused_sweep": [{"density": 0.8, "phi_mean": 7.485260366813871, "phi_std": 0.7797794348003165, "lz_mean": 0.43822751656338116, "lz_std": 0.023111441199349745, "smf_mean": 0.580715077891644, "smf_std": 0.01391368021194842}, {"density": 0.8135714285714286, "phi_mean": 7.586990713646254, "phi_std": 0.6630248012806162, "lz_mean": 0.42442376556726713, "lz_std": 0.024994998033640487, "smf_mean": 0.5667326018487855, "smf_std": 0.004086575758961269}, {"density": 0.8271428571428572, "phi_mean": 7.230665812803745, "phi_std": 0.28712760946028276, "lz_mean": 0.44321682415233815, "lz_std": 0.00892591946217499, "smf_mean": 0.5817177391231765, "smf_std": 0.011873577177655387}, {"density": 0.8407142857142857, "phi_mean": 7.430662921844411, "phi_std": 0.5302269658620541, "lz_mean": 0.43955799858710304, "lz_std": 0.028535902660608514, "smf_mean": 0.5766813077619208, "smf_std": 0.0034615788647809195}, {"density": 0.8542857142857143, "phi_mean": 7.53811623936577, "phi_std": 0.07850708742988595, "lz_mean": 0.44130425624323794, "lz_std": 0.009579817044225246, "smf_mean": 0.5999692517630691, "smf_std": 0.016314695385650006}, {"density": 0.8678571428571429, "phi_mean": 7.942270384381726, "phi_std": 0.7255134338399278, "lz_mean": 0.40604648261460924, "lz_std": 0.027696524801748036, "smf_mean": 0.5965749226233895, "smf_std": 0.016898870737973713}, {"density": 0.8814285714285715, "phi_mean": 7.3687073385233335, "phi_std": 0.25582801756466167, "lz_mean": 0.44321682415233815, "lz_std": 0.014281877843263496, "smf_mean": 0.5811244317393648, "smf_std": 0.012667825479001173}, {"density": 0.895, "phi_mean": 8.044272289967113, "phi_std": 0.7276890963554595, "lz_mean": 0.3717034153772892, "lz_std": 0.06370735610325066, "smf_mean": 0.6120078348417255, "smf_std": 0.02918794785113153}, {"density": 0.9085714285714286, "phi_mean": 8.317142560826435, "phi_std": 0.41538377205269245, "lz_mean": 0.4072106543853658, "lz_std": 0.01824833519408934, "smf_mean": 0.609598965410437, "smf_std": 0.010568780769576722}, {"density": 0.9221428571428572, "phi_mean": 7.34537864901386, "phi_std": 0.7664168680656137, "lz_mean": 0.410620014571153, "lz_std": 0.0208160386332541, "smf_mean": 0.5812490000552628, "smf_std": 0.001253022203882943}, {"density": 0.9357142857142857, "phi_mean": 7.443145992856347, "phi_std": 1.067019959886181, "lz_mean": 0.38234727156706394, "lz_std": 0.0567709007060305, "smf_mean": 0.5968396392928234, "smf_std": 0.023412268725518992}, {"density": 0.9492857142857143, "phi_mean": 9.43739382378628, "phi_std": 1.235745151502955, "lz_mean": 0.32862905985929464, "lz_std": 0.0625030130176938, "smf_mean": 0.6145852575110916, "smf_std": 0.030331162420590693}, {"density": 0.9628571428571429, "phi_mean": 7.617612379937832, "phi_std": 1.206646780948278, "lz_mean": 0.4130315132391489, "lz_std": 0.022813317595026104, "smf_mean": 0.5997863568011684, "smf_std": 0.03744617725652741}, {"density": 0.9764285714285714, "phi_mean": 7.9244079954389335, "phi_std": 0.7375052417870674, "lz_mean": 0.3962341776896607, "lz_std": 0.038245753839009904, "smf_mean": 0.5793083635039641, "smf_std": 0.005845344264358361}, {"density": 0.99, "phi_mean": 8.885617764472158, "phi_std": 0.5412506088625673, "lz_mean": 0.38326197795837263, "lz_std": 0.014688594603729774, "smf_mean": 0.6068133255926312, "smf_std": 0.021509638633219023}], "focused_derivatives": [{"density": 0.8, "dphi": 7.4959202929124435, "dlz": -1.0171184944505076, "dsmf": -1.0302877084211541, "convergence": 0.016647533301703512}, {"density": 0.8135714285714286, "dphi": -9.379799358267794, "dlz": 0.1838165953826261, "dsmf": 0.03694015063540701, "convergence": 0.00013498073577954375}, {"density": 0.8271428571428572, "dphi": -5.759444961120528, "dlz": 0.5575770059939547, "dsmf": 0.36653127048393397, "convergence": 0.0024945452297381165}, {"density": 0.8407142857142857, "dphi": 11.327120978600925, "dlz": -0.07046302823000797, "dsmf": 0.6724241498907826, "convergence": 0.001137415147660374}, {"density": 0.8542857142857143, "dphi": 18.848695988216868, "dlz": -1.234634798986614, "dsmf": 0.7329226527909515, "convergence": 0.036147047587171556}, {"density": 0.8678571428571429, "dphi": -6.241380557352939, "dlz": 0.07046302823000797, "dsmf": -0.6942828429785818, "convergence": 0.0006471027762166898}, {"density": 0.8814285714285715, "dphi": 3.7579649426195108, "dlz": -1.265270898217055, "dsmf": 0.56858097646501, "convergence": 0.005729588488558446}, {"density": 0.895, "dphi": 34.94235029537742, "dlz": -1.326543096677929, "dsmf": 1.0490617668289768, "convergence": 0.10305507864754297}, {"density": 0.9085714285714286, "dphi": -25.748713087751437, "dlz": 1.4337694439844566, "dsmf": -1.1332202289749413, "convergence": 0.08866332821582719}, {"density": 0.9221428571428572, "dphi": -32.19987355679272, "dlz": -0.9160193669900688, "dsmf": -0.4700804359120822, "convergence": 0.02938501126820503}, {"density": 0.9357142857142857, "dphi": 77.0742432810892, "dlz": -3.020719384121098, "dsmf": 1.2281779062673772, "convergence": 0.6060044246847481}, {"density": 0.9492857142857143, "dphi": 6.427708997738918, "dlz": 1.1304720616031299, "dsmf": 0.10856327662323967, "convergence": 0.0016718366652254623}, {"density": 0.9628571428571429, "dphi": -55.741583149639105, "dlz": 2.4907148674345394, "dsmf": -1.2996750423678565, "convergence": 0.3824132700145702}, {"density": 0.9764285714285714, "dphi": 46.71598785126468, "dlz": -1.0967723524496515, "dsmf": 0.2588883238959982, "convergence": 0.02811184550444433}, {"density": 0.99, "dphi": 70.82598298139554, "dlz": -0.9558462959896459, "dsmf": 2.0266814170596854, "convergence": 0.29077764860855554}], "focused_peak": {"density": 0.9357142857142857, "convergence": 0.6060044246847481}, "phase_analysis_broad": {"8": {"peaks": {"phi": {"density": 0.6263157894736842, "magnitude": 1.2037699158279582}, "lz": {"density": 0.98, "magnitude": -0.9966293421122645}, "smf": {"density": 0.6263157894736842, "magnitude": 0.19317851379154077}}, "convergence": {"mean_density": 0.7442105263157894, "std_density": 0.16672833577451227, "score": 0.03563002080344194}}, "16": {"peaks": {"phi": {"density": 0.4242105263157895, "magnitude": 0.44490417348114897}, "lz": {"density": 0.4747368421052632, "magnitude": -0.3849217209509057}, "smf": {"density": 0.02, "magnitude": 0.13253014585552736}}, "convergence": {"mean_density": 0.30631578947368426, "std_density": 0.20350393218685595, "score": 0.0170760455306414}}, "32": {"peaks": {"phi": {"density": 0.7273684210526316, "magnitude": 6.38634063291724}, "lz": {"density": 0.98, "magnitude": -1.208317150873127}, "smf": {"density": 0.4747368421052632, "magnitude": 0.07167432479218627}}, "convergence": {"mean_density": 0.7273684210526317, "std_density": 0.2062728204448992, "score": 0.016156119108658593}}}, "phase_analysis_large": {"64": {"peaks": {"phi": {"density": 0.98, "magnitude": 24.229465822725555}, "lz": {"density": 0.8806896551724138, "magnitude": -1.948876093666772}, "smf": {"density": 0.8806896551724138, "magnitude": 0.4611758048545883}}, "convergence": {"mean_density": 0.9137931034482759, "std_density": 0.04681534551304037, "score": 0.3920731261607602}}}};

const COLORS = {
  phi: { main: '#f97583', bg: 'rgba(249,117,131,0.15)', border: 'rgba(249,117,131,0.4)' },
  lz: { main: '#7ee787', bg: 'rgba(126,231,135,0.15)', border: 'rgba(126,231,135,0.4)' },
  smf: { main: '#d2a8ff', bg: 'rgba(210,168,255,0.15)', border: 'rgba(210,168,255,0.4)' },
  conv: { main: '#ffa657', bg: 'rgba(255,166,87,0.15)', border: 'rgba(255,166,87,0.4)' },
};

const chartOpts = {
  responsive: true,
  maintainAspectRatio: true,
  plugins: { legend: { display: false } },
  scales: {
    x: { grid: { color: '#21262d' }, ticks: { color: '#8b949e', font: { size: 11 } }, title: { display: true, text: 'Connection Density', color: '#8b949e' } },
    y: { grid: { color: '#21262d' }, ticks: { color: '#8b949e', font: { size: 11 } } }
  },
  elements: { point: { radius: 3, hoverRadius: 6 }, line: { tension: 0.3 } }
};

let charts = {};
let currentView = 'large';

function makeDataset(data, key, color) {
  return {
    label: key,
    data: data.map(d => ({ x: d.density, y: d[key + '_mean'] })),
    borderColor: color.main,
    backgroundColor: color.bg,
    borderWidth: 2,
    fill: true,
    pointBackgroundColor: color.main,
  };
}

function makeErrorBands(data, key, color) {
  const upper = data.map(d => ({ x: d.density, y: d[key + '_mean'] + d[key + '_std'] }));
  const lower = data.map(d => ({ x: d.density, y: d[key + '_mean'] - d[key + '_std'] }));
  return [
    { data: upper, borderColor: 'transparent', backgroundColor: color.bg, fill: '+1', pointRadius: 0, borderWidth: 0 },
    { data: lower, borderColor: 'transparent', backgroundColor: 'transparent', fill: false, pointRadius: 0, borderWidth: 0 },
  ];
}

function getData() {
  if (currentView === 'focused') return DATA.focused_sweep;
  const size = document.getElementById('size-select').value;
  if (currentView === 'large') return DATA.large_sweep[size] || DATA.broad_sweep[size];
  return DATA.broad_sweep[size] || DATA.large_sweep[size];
}

function getDerivatives() {
  if (currentView === 'focused') return DATA.focused_derivatives;
  return null;
}

function createChart(canvasId, data, key, color) {
  const ctx = document.getElementById(canvasId).getContext('2d');
  if (charts[canvasId]) charts[canvasId].destroy();
  const ds = makeDataset(data, key, color);
  charts[canvasId] = new Chart(ctx, {
    type: 'line',
    data: { datasets: [ds] },
    options: { ...chartOpts, scales: { ...chartOpts.scales, x: { ...chartOpts.scales.x, type: 'linear' } } }
  });
}

function createConvChart(canvasId) {
  const ctx = document.getElementById(canvasId).getContext('2d');
  if (charts[canvasId]) charts[canvasId].destroy();
  const derivs = getDerivatives();
  if (derivs) {
    charts[canvasId] = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: derivs.map(d => d.density.toFixed(3)),
        datasets: [{
          data: derivs.map(d => d.convergence),
          backgroundColor: derivs.map(d => d.convergence > 0.3 ? COLORS.conv.main : COLORS.conv.bg),
          borderColor: COLORS.conv.border,
          borderWidth: 1,
        }]
      },
      options: { ...chartOpts, scales: { ...chartOpts.scales, x: { ...chartOpts.scales.x, type: 'category' } } }
    });
  } else {
    const data = getData();
    if (!data || data.length < 3) return;
    const densities = data.map(d => d.density);
    const measures = ['phi', 'lz', 'smf'].map(k => data.map(d => d[k + '_mean']));
    const derivs2 = measures.map(m => {
      const d = [];
      for (let i = 0; i < m.length; i++) {
        if (i === 0) d.push((m[1] - m[0]) / (densities[1] - densities[0]));
        else if (i === m.length - 1) d.push((m[i] - m[i-1]) / (densities[i] - densities[i-1]));
        else d.push((m[i+1] - m[i-1]) / (densities[i+1] - densities[i-1]));
      }
      return d;
    });
    const norms = derivs2.map(d => { const mx = Math.max(...d.map(Math.abs)) || 1; return d.map(v => Math.abs(v) / mx); });
    const conv = densities.map((_, i) => norms[0][i] * norms[1][i] * norms[2][i]);
    charts[canvasId] = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: densities.map(d => d.toFixed(3)),
        datasets: [{
          data: conv,
          backgroundColor: conv.map(c => c > 0.3 ? COLORS.conv.main : COLORS.conv.bg),
          borderColor: COLORS.conv.border,
          borderWidth: 1,
        }]
      },
      options: { ...chartOpts, scales: { ...chartOpts.scales, x: { ...chartOpts.scales.x, type: 'category', ticks: { maxRotation: 45 } } } }
    });
  }
}

function createOverlay(canvasId) {
  const ctx = document.getElementById(canvasId).getContext('2d');
  if (charts[canvasId]) charts[canvasId].destroy();
  const data = getData();
  if (!data) return;
  // Normalize each measure to [0,1]
  const normalize = (arr) => {
    const min = Math.min(...arr), max = Math.max(...arr);
    const range = max - min || 1;
    return arr.map(v => (v - min) / range);
  };
  const phis = normalize(data.map(d => d.phi_mean));
  const lzs = normalize(data.map(d => d.lz_mean));
  const smfs = normalize(data.map(d => d.smf_mean));
  const densities = data.map(d => d.density);

  charts[canvasId] = new Chart(ctx, {
    type: 'line',
    data: {
      datasets: [
        { label: 'Φ (normalized)', data: densities.map((d, i) => ({ x: d, y: phis[i] })), borderColor: COLORS.phi.main, backgroundColor: 'transparent', borderWidth: 2, pointRadius: 2, tension: 0.3 },
        { label: 'LZ (normalized)', data: densities.map((d, i) => ({ x: d, y: lzs[i] })), borderColor: COLORS.lz.main, backgroundColor: 'transparent', borderWidth: 2, pointRadius: 2, tension: 0.3 },
        { label: 'SMF (normalized)', data: densities.map((d, i) => ({ x: d, y: smfs[i] })), borderColor: COLORS.smf.main, backgroundColor: 'transparent', borderWidth: 2, pointRadius: 2, tension: 0.3 },
      ]
    },
    options: {
      ...chartOpts,
      plugins: { legend: { display: true, labels: { color: '#8b949e', font: { size: 11 } } } },
      scales: { ...chartOpts.scales, x: { ...chartOpts.scales.x, type: 'linear' }, y: { ...chartOpts.scales.y, title: { display: true, text: 'Normalized [0,1]', color: '#8b949e' } } }
    }
  });
}

function updateCharts() {
  const data = getData();
  if (!data) return;
  createChart('chart-phi', data, 'phi', COLORS.phi);
  createChart('chart-lz', data, 'lz', COLORS.lz);
  createChart('chart-smf', data, 'smf', COLORS.smf);
  createConvChart('chart-conv');
  createOverlay('chart-overlay');
}

function setView(view) {
  currentView = view;
  document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
  document.getElementById('btn-' + view).classList.add('active');
  const sel = document.getElementById('size-select');
  if (view === 'focused') {
    sel.disabled = true;
  } else if (view === 'large') {
    sel.disabled = false;
    sel.value = '64';
  } else {
    sel.disabled = false;
    if (sel.value === '64') sel.value = '32';
  }
  updateCharts();
}

updateCharts();
</script>
</body>
</html>
